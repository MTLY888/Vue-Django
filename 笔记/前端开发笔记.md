#   ç¬¬ä¸€ç« ï¼šDjangoå­¦ä¹ 

## 1.1-1.2

![image-20251001150115345](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251001150115345.png)

## 1.3ï¼š å¿«é€Ÿå¯åŠ¨

ç½‘ç«™å¯åŠ¨èµ·æ¥ï¼Œé€šè¿‡æµè§ˆå™¨å°±å¯ä»¥è®¿é—®äº†ã€‚

é¦–å…ˆåˆ›å»ºé¡¹ç›®ï¼š<code>django-admin startproject  åå­—</code>

- æ‰“å¼€ç»ˆç«¯å¹¶ä¸”è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼ˆçœ‹åˆ°manage.py)
- æ‰§è¡Œå‘½ä»¤ï¼Œå¯åŠ¨ç½‘ç«™ï¼š<code>python manage.py runserver</code>
- ![image-20251001151050963](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251001151050963.png)

## 1.4 ï¼šAPP

åœ¨Djangoä¸­åˆ›å»ºAPPï¼Œåœ¨APPä¸­ç¼–å†™é¡¹ç›®ä¸­çš„å…·ä½“ä¸šåŠ¡ã€‚

æ‰§è¡Œ<code>python manage.py startapp web</code>å‘½ä»¤åï¼Œä¼šåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”åœ¨æ–‡ä»¶å¤¹ä¸­ä¼šåˆ›å»ºç›¸å…³çš„æ–‡ä»¶ã€‚

ä»£ç ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

E:.
â”‚  db.sqlite3
â”‚  manage.py
â”‚  
â”œâ”€mysite
â”‚  â”‚  asgi.py
â”‚  â”‚  settings.py
â”‚  â”‚  urls.py
â”‚  â”‚  wsgi.py
â”‚  â”‚  __init__.py
â”‚  â”‚  
â”‚  â””â”€__pycache__
â”‚          settings.cpython-39.pyc
â”‚          urls.cpython-39.pyc
â”‚          wsgi.cpython-39.pyc
â”‚          __init__.cpython-39.pyc
â”‚
â””â”€web
    â”‚  admin.py   [å†…éƒ¨åå°ç®¡ç†é…ç½®ï¼Œä¸è¦åŠ¨]
    â”‚  apps.py    [Appåå­—ï¼Œä¸ç”¨åŠ¨ï¼Œä¸ç”¨ä¿®æ”¹]
    â”‚  models.py   [æ•°æ®åº“ï¼Œç±»->SQLè¯­å¥(ORM)] 	ï¼ˆç»å¸¸ä½¿ç”¨ï¼‰
    â”‚  tests.py     [å•å…ƒæµ‹è¯•ï¼Œä¸ç”¨åŠ¨]
    â”‚  views.py     [è§†å›¾å‡½æ•°ï¼Œä¾‹å¦‚loginå‡½æ•°]     ï¼ˆç»å¸¸ä½¿ç”¨ï¼‰
    â”‚  __init__.py
    â”‚
    â””â”€migrations   [è¿ç§»è®°å½•ï¼Œè‡ªåŠ¨ç”Ÿæˆï¼Œä¸éœ€è¦ä¿®æ”¹]
            __init__.py

## å°ç»“

+ å®‰è£…Djangoæ¡†æ¶ <code> pip install django=3</code>
+ åˆ›å»ºé¡¹ç›®-å‘½ä»¤ <code>django-admin startproject åå­—</code>
+ åˆ›å»ºAPP <code>python manage.py startapp åå­—</code>
+ ç¼–å†™ä¸šåŠ¡ä»£ç ï¼šurls.pyã€views.py
+ å¯åŠ¨é¡¹ç›® <code>python manage.py runserver</code>

# ç¬¬äºŒç« ï¼šåˆè¯†è§†å›¾å‡½æ•°

## 2.1 åŸºæœ¬æ¨¡å—å†…å®¹ä»‹ç»

```py
from django.shortcuts import render
from django.shortcuts import HttpResponse
def login(request):
    return HttpResponse("Hello, World!")
```

- requestæ˜¯ç”¨æˆ·è¯·æ±‚çš„æ‰€æœ‰å†…å®¹ï¼Œå»requestä¸­è·å–ç”¨æˆ·æäº¤çš„æ‰€æœ‰ä¿¡æ¯ã€‚

- å‡½æ•°ä¸­é—´è¿›è¡Œä¸šåŠ¡é€»è¾‘æ“ä½œ

- è¿”å›å€¼ï¼Œè¿”å›ä»€ä¹ˆä½“ç°ç”¨æˆ·æµè§ˆå™¨çš„è¡Œä¸ºä¸åŒ

  - ```py
    return HttpResponse("Hello, World!")
    ```

  - ```p
    return render(request,'login.html')   è¿”å›htmlé¡µé¢
    ```

  - ```pytho
    return redirect("https://www.baidu.com") è·³è½¬é¡µé¢
    ```

## 2.2 æ–‡ä»¶è·¯å¾„å¯»æ‰¾

![image-20251001163430402](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251001163430402.png)

## å°ç»“

- å‚æ•°ï¼Œå»requestä¸­è·å–å€¼

- setting.pyé—®ä»·

  ```py
  INSTALLED_APPS = [
      "django.contrib.admin",
      "django.contrib.auth",
      "django.contrib.contenttypes",
      "django.contrib.sessions",
      "django.contrib.messages",
      "django.contrib.staticfiles",
  ]
  ............///////
  TEMPLATES = [
      {
          "BACKEND": "django.template.backends.django.DjangoTemplates",
          "DIRS": [],
          "APP_DIRS": True,
          "OPTIONS": {
              "context_processors": [
                  "django.template.context_processors.debug",
                  "django.template.context_processors.request",
                  "django.contrib.auth.context_processors.auth",
                  "django.contrib.messages.context_processors.messages",
              ],
          },
      },
  ]
  ```

  ä¼šä¼˜å…ˆåœ¨é¡¹ç›®è®¾ç½®çš„ â€œDIRSâ€ä¸­çš„ç›®å½•å»æŸ¥æ‰¾ï¼Œç„¶åå†å»â€œINSTALLED_APPSâ€ä¸­æŸ¥æ‰¾

  - å•ç‹¬APPæ¨¡æ¿ï¼Œåœ¨APPä¸­å†™ã€‚å…¬å…±çš„å°±åœ¨æœ€å¤–å±‚çš„templatesä¸­å†™HTMLæ¨¡æ¿ã€‚

# ç¬¬ä¸‰ç« ï¼šåˆè¯†æ¨¡æ¿

webæ¡†æ¶ä¸­éƒ½è¦ç”¨åˆ°æ¨¡æ¿çš„è¯­æ³•ï¼Œç”¨æˆ·çœ‹åˆ°çš„æ˜¯åŠ¨æ€çš„ã€‚

<strong>æ¡ˆä¾‹ï¼šå·ç åˆ—è¡¨</strong>

- URLè®¿é—® -ã€‹ å»æ•°æ®åº“è·å–æ•°æ®åˆ—è¡¨ -ã€‹ é¡µé¢ä¸Šå±•ç¤º 

# ç¬¬å››ç« ï¼šé™æ€æ–‡ä»¶å¤„ç†

å›¾ç‰‡ã€cssã€jsç­‰ã€‚

![image-20251002140900441](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251002140900441.png)

ç›¸å…³çš„é™æ€æ–‡ä»¶éƒ½æ”¾åˆ°è¿™ä¸ªstaticæ–‡ä»¶å¤¹ä¸‹é¢ï¼Œå¼•ç”¨ä»£ç å¦‚ä¸‹ï¼š

```py
{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†ç³»ç»Ÿé¦–é¡µ</title>
    <link rel="stylesheet" href="{% static 'bootstrap-3.0.0/dist/css/bootstrap.min.css' %}">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        
        .navbar-brand {
            font-weight: bold;
            font-size: 20px;
        }
        
        .main-content {
            margin-top: 30px;
            margin-bottom: 50px;
        }
        
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin: 0 -15px 30px -15px;
            border-radius: 0;
        }
        
        .page-header h1 {
            margin: 0;
            text-align: center;
            font-size: 32px;
            font-weight: 300;
        }
        
        .stats-cards {
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .table-container {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .table-title {
            margin-bottom: 20px;
            color: #333;
            font-size: 20px;
            font-weight: 500;
        }
        
        .table {
            margin-bottom: 0;
        }
        
        .table thead th {
            background-color: #f8f9fa;
            border-top: none;
            font-weight: 600;
            color: #495057;
            padding: 15px;
        }
        
        .table tbody td {
            padding: 12px 15px;
            vertical-align: middle;
        }
        
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .btn-toolbar {
            margin-bottom: 20px;
        }
        
        .search-box {
            max-width: 300px;
        }
        
        .navbar-nav > li > a {
            padding-top: 20px;
            padding-bottom: 20px;
        }
        
        .navbar {
            min-height: 60px;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="sr-only">åˆ‡æ¢å¯¼èˆª</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/index/">ğŸ“± é€šè®¯å½•ç®¡ç†ç³»ç»Ÿ</a>
            </div>

            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="/index/">é¦–é¡µ</a></li>
                    <li><a href="/user_list/">ç”¨æˆ·åˆ—è¡¨</a></li>
                    <li><a href="/phone_list/">ç”µè¯åˆ—è¡¨</a></li>
                </ul>
                
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            ğŸ‘¤ ç”¨æˆ·ä¸­å¿ƒ <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="#">ä¸ªäººèµ„æ–™</a></li>
                            <li><a href="#">è®¾ç½®</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="/login/">é€€å‡ºç™»å½•</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="container main-content" style="margin-top: 80px;">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1>ğŸ“Š ç³»ç»Ÿæ¦‚è§ˆ</h1>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="row stats-cards">
            <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                    <div class="stat-number">{{ queryset|length }}</div>
                    <div class="stat-label">æ€»è”ç³»äººæ•°</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                    <div class="stat-number">4</div>
                    <div class="stat-label">åŸå¸‚åˆ†å¸ƒ</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                    <div class="stat-number">100%</div>
                    <div class="stat-label">æ•°æ®å®Œæ•´æ€§</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                    <div class="stat-number">åœ¨çº¿</div>
                    <div class="stat-label">ç³»ç»ŸçŠ¶æ€</div>
                </div>
            </div>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div class="table-container">
            <div class="table-title">
                ğŸ“ è”ç³»äººåˆ—è¡¨
            </div>
            
            <div class="btn-toolbar">
                <div class="btn-group">
                    <button type="button" class="btn btn-primary">
                        <span class="glyphicon glyphicon-plus"></span> æ·»åŠ è”ç³»äºº
                    </button>
                    <button type="button" class="btn btn-default">
                        <span class="glyphicon glyphicon-export"></span> å¯¼å‡ºæ•°æ®
                    </button>
                </div>
                <div class="pull-right">
                    <div class="input-group search-box">
                        <input type="text" class="form-control" placeholder="æœç´¢è”ç³»äºº...">
                        <span class="input-group-btn">
                            <button class="btn btn-default" type="button">
                                <span class="glyphicon glyphicon-search"></span>
                            </button>
                        </span>
                    </div>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th width="10%">ID</th>
                            <th width="30%">ğŸ“± ç”µè¯å·ç </th>
                            <th width="25%">ğŸ™ï¸ å½’å±åœ°</th>
                            <th width="35%">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in queryset %}
                        <tr>
                            <td><span class="badge">{{ row.id }}</span></td>
                            <td><strong>{{ row.phone }}</strong></td>
                            <td>
                                <span class="label label-info">{{ row.city }}</span>
                            </td>
                            <td>
                                <button class="btn btn-xs btn-info">
                                    <span class="glyphicon glyphicon-eye-open"></span> æŸ¥çœ‹
                                </button>
                                <button class="btn btn-xs btn-warning">
                                    <span class="glyphicon glyphicon-edit"></span> ç¼–è¾‘
                                </button>
                                <button class="btn btn-xs btn-danger">
                                    <span class="glyphicon glyphicon-trash"></span> åˆ é™¤
                                </button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">
                                <em>æš‚æ— æ•°æ®</em>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- åˆ†é¡µ -->
            <nav class="text-center">
                <ul class="pagination">
                    <li class="disabled"><a href="#">&laquo;</a></li>
                    <li class="active"><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">&raquo;</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- åº•éƒ¨ -->
    <footer class="text-center" style="padding: 20px; background-color: #f8f9fa; margin-top: 50px;">
        <p class="text-muted">&copy; 2024 é€šè®¯å½•ç®¡ç†ç³»ç»Ÿ. All rights reserved.</p>
    </footer>

    <script src="{% static 'jQuery/jquery-3.6.0.min.js' %}"></script>
    <script src="{% static 'bootstrap-3.0.0/dist/js/bootstrap.min.js' %}"></script>
</body>
</html> 
```

# ç¬¬äº”ç« ï¼šORM

ORMï¼šå¯¹è±¡å…³ç³»æ˜ å°„ã€‚

![image-20251002142828031](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251002142828031.png)

å‡ºç°çš„ç›®çš„ï¼šä¾¿äºå¯¹é¡¹ç›®ä¸­çš„æ•°æ®åº“è¿›è¡Œå¼€å‘ã€‚

- åˆ›å»ºè¡¨ç»“æ„&ä¿®æ”¹è¡¨ç»“æ„
- å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹

## 5.1:è‡ªå·±åˆ›å»ºæ•°æ®åº“

- ç¬¬ä¸€æ­¥åˆ›å»ºä»¥è‡ªå·±çš„æ•°æ®åº“ç”¨æˆ·

![image-20251002155706583](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251002155706583.png)

- ```py
  CREATE DATABASE IF NOT EXISTS mydb CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
  ```



## 5.2ï¼šåˆ›å»ºè¡¨

å»APPä¸‹çš„model.pyä¸­åˆ›å»ºæŒ‡å®šçš„ç±»+å‘½ä»¤ï¼Œè‡ªåŠ¨åˆ›å»ºè¡¨ã€‚

çº¿è¿æ¥æ•°æ®åº“ï¼šday08

åœ¨setting.pyæ–‡ä»¶ä¸­

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'day08',
        'USER': 'root',
        'PASSWORD': '',
        'HOST': 'localhost',
        'PORT': 3306,
    }
}
```

- python ä»£ç è¿æ¥æ•°æ®åº“ï¼špymysqlã€mysqlclient

```python
pip install mysqlclient
```

å†å»æ‰§è¡Œ 5.2.2ï¼šå‘½ä»¤

### 5.2.1ï¼šç¼–å†™ç±»

```python
from django.db import models
class UserInfo(models.Model):
    name = models.CharField(verbose_name='æ€§åˆ«',max_length=12)
    age = models.IntegerField(verbose_name='å¹´é¾„')  
    email = models.EmailField(verbose_name='é‚®ç®±',max_length=32)
# Create your models here.
```

### 5.2.2ï¼šå‘½ä»¤

```py
python manage.py makemigrations
python manage.py migrate	
```

- makemigrationsï¼šè¯»å–å·²ç»æ³¨å†Œçš„æ‰€æœ‰APPä¸­çš„models.pyæ–‡ä»¶ï¼Œæ ¹æ®ç±»ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œå¹¶æ”¾åˆ°APPä¸‹çš„migrationsç›®å½•ã€‚
- migrate,æ ¹æ®é…ç½®æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„SQLè¯­å¥ã€‚

### 5.2.3ï¼šå°ç»“

- è‡ªå·±åˆ›å»ºæ•°æ®åº“

- djangoä¸­é…ç½®è¿æ¥æ•°æ®åº“

- pythonæ“ä½œmysqlæ¨¡å—

  - ```python
    python install mysqlclient	
    ```

- model.pyä¸­å†™ç›¸åº”çš„ç±»

- å†™å®Œåå»æ‰§è¡Œç›¸åº”çš„å‘½ä»¤

  - ```python
    python manage.py makemigrations
    python manage.py migrate
    ```

## 5.3  æ•°æ®æ“ä½œ

```python
#model.py
from django.db import models
class UserInfo(models.Model):
    name = models.CharField(verbose_name='æ€§åˆ«',max_length=12)
    age = models.IntegerField(verbose_name='å¹´é¾„')  
    email = models.EmailField(verbose_name='é‚®ç®±',max_length=32)
# Create your models here.
```

- æ–°å¢

  - ```python
    models.UserInfo.objects.create(name = "Cheng",pwd = "123",age = 19,email = "xxx@qq.com")
    #æˆ–è€…
    models.UserInfo.objects.create(**{"name":"Cheng","pwd":"123","age":"18","email":"xxx@qq.com"})
    ```

- æŸ¥è¯¢

  - ```python
    #queryset = [obj,obj,obj]    obj.id,obj.name,obj.age,obj.pwd
    v1 = models.UserInfo.objects.filters(name = 'wupeiqi',age = 18)
    #queryset = [obj,obj,obj]    obj.id,obj.name,obj.age,obj.pwd
    v2 = models.UserInfo.objects.all()
    V3 = models.UserInfo.objects.filter(name = 'wupeiqi',age = 19).first()
    #æ³¨æ„ï¼šæœªæŸ¥è¯¢åˆ°æ•°æ®æ—¶è¿”å›None
    ```

- åˆ é™¤

  ```python
  models.UserInfo.objects.all().delete()
  models.UserInfo.objects.filter(name='wupeiqi',age = 10).delete()
  ```

- ä¿®æ”¹

  ```python
  models.UserInfo.objects.all().update(age=19)
  models.UserInfo.objects.filter(id=10).update(age=19)
  ```

## æ¡ˆä¾‹

- åˆ›å»ºæ•°æ®åº“

- åˆ›å»ºæ•°æ®åº“è¡¨

  - ```pytho
    #model.py
    from django.db import models
    class UserInfo(models.Model):
        name = models.CharField(verbose_name='æ€§åˆ«',max_length=12)
        age = models.IntegerField(verbose_name='å¹´é¾„')  
        email = models.EmailField(verbose_name='é‚®ç®±',max_length=32)
    # Create your models here.
    ```

## æ€»ç»“

- Djangoæ¡†æ¶

  - ```python
    pip install django=3
    ```

- åˆ›å»ºé¡¹ç›®

- é…ç½®

  - æ³¨å†ŒAPP
  - MySqlè¿æ¥ï¼ˆæ•°æ®åº“å…ˆåˆ›å»ºï¼‰

- å†APPç›®æ ‡ä¸‹çš„models.pyä¸­åˆ›å»ºè¡¨ç»“æ„

  - å†™models
  - å‘½ä»¤

- å†™åŠŸèƒ½ä»£ç 

  - urls.py
  - views.py(åŸºäºORMå¯¹æ•°æ®åº“ä¸­çš„è¡¨æ•°æ®è¿›è¡Œæ“ä½œ)
  - templatesï¼ˆä¸»è¦æ”¾ç½®HTMLæ–‡ä»¶ï¼‰

- é™æ€æ–‡ä»¶é…ç½®ï¼ˆCSSï¼ŒJSï¼Œå›¾ç‰‡ï¼‰

# ç¬¬å…­ç« ï¼šDjangoè¿›é˜¶

## 6.1ï¼šCookieå’ŒSession

é¡¹ç›®ç™»é™†ç›¸å…³

![image-20251003154228169](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251003154228169.png)

<strong>ç”¨æˆ·ç™»å½•æµç¨‹</strong>

![image-20251003165415663](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251003165415663.png)



## 6.2ï¼šä¸­é—´ä»¶

!![image-20251003192928888](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251003192928888.png)(C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251003185509278.png) 

```python
#Setting.py
MIDDLEWARE = [
    "django.middleware.security.SecurityMiddleware",
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "django.middleware.clickjacking.XFrameOptionsMiddleware",
    "myproject01.exit.md.MyMiddleware",    #è¯¥è¡Œä¸ºè‡ªå·±æ·»åŠ çš„ä¸­é—´ä»¶
]
```

ä»¥ä¸Šä»£ç ä¸­ä¾¿æ˜¯ä¸€ä¸ªä¸ªä¸­é—´ä»¶

è‡ªå·±å†™çš„ä¸­é—´ä»¶ä¹Ÿè¦å†â€œMIDDLEWAREâ€ä¸­è¿›è¡Œæ³¨å†Œã€‚

ç‰¹ç‚¹ï¼šæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»è¿‡ä¸­é—´ä»¶ã€‚

```pytho
# md.py
from django.utils.deprecation import MiddlewareMixin
from django.shortcuts import redirect

class MyMiddleware(MiddlewareMixin):
    def process_request(self, request):
        # å®šä¹‰ä¸éœ€è¦ç™»å½•éªŒè¯çš„URLç™½åå•
        white_list = ['/login/', '/admin/']
        
        # å¦‚æœå½“å‰è¯·æ±‚çš„URLåœ¨ç™½åå•ä¸­ï¼Œç›´æ¥æ”¾è¡Œ
        if request.path_info in white_list: 
            return None
            
        # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
        info_dict = request.session.get("info")
        if info_dict:
            # å·²ç™»å½•ç”¨æˆ·ï¼Œç»§ç»­å¤„ç†è¯·æ±‚
            request.info = info_dict
            return None
        else:
            # æœªç™»å½•ç”¨æˆ·ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
            return redirect("/login/")
    
    def process_response(self, request, response):
        return response
```

ä»¥ä¸Šä¸ºä¸­é—´ä»¶çš„å†…å®¹

- æœ‰æ—¶å€™staticä¸­çš„é™æ€æ–‡ä»¶æ²¡æœ‰åŠæ³•æ­£ç¡®æ˜¾ç¤ºï¼Œæœ‰å¯èƒ½æ˜¯å› ä¸ºä¸­é—´ä»¶æŠŠé™æ€æ–‡ä»¶é˜»æ­¢äº†ã€‚å¯ä»¥åœ¨md.pyæ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ç™½åå•ã€‚

## 6.3ï¼šæ¯ç‰ˆçš„æ¦‚å¿µ

- æ¯ç‰ˆæ–‡ä»¶

  - ```python
    #layout.html
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <title>layout</title>
        {% block css %}
        {% endblock %}
      </head>
      <body>
        <div style="width: 100%;height: 100px;background-color: #000;">å¯¼èˆªæ </div>
        <div class="container">
          {% block content %}
          {% endblock %}
        </div>
        {% block js %}
        {% endblock %}
      </body>
    </html>
    ```

- ç»§æ‰¿æ¯ç‰ˆçš„æ–‡ä»¶

  - ```python
    #home.html
    {% extends "layout.html" %}
    {% block css %}
    
    {% endblock %}
    {% block content %}
    <h2>æ¬¢è¿{{ request.session.info }}</h2>
    {% endblock %}
    {% block js %}
    
    {% endblock %}
    ```

## 6.4ï¼šè¿è¡¨æ“ä½œ

![image-20251003202601087](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251003202601087.png)

  å…¶ä¸­departå­—æ®µä¼šåœ¨æ•°æ®åº“ä¸­å˜ä¸ºdepart_idã€‚

- æ–°å¢

  - ```python
    models.User.objects.create(name="wupeiqi",age=11,salary=10000,depart_id=1)
    #æ–¹å¼äºŒ
    depart_object = models.Department.object.filter(id=1).first()
    models.User.object.create(name="Cheng",age=11,salary=100000,depart=depart_object)
    ```

- æŸ¥è¯¢

  - ```python
    models.User.objects.filter(name='XX')
    models.User.objects.filter(salary='')
    models.User.objects.filter(depart_id=1)
    models.User.objects.filter(depart__title="é”€å”®")   #åŒä¸‹åˆ’çº¿ï¼Œå¯ä»¥è¿è¡¨è®¿é—®åˆ°departmentè¡¨
    ```

  - è·å–æ•°æ®

    - ```python
      queryset = models.User.objects.all()
      for row in queryset:
          row.id,row.name   row.depart.title      #å…¶ä¸­row.depart è·å–åˆ°çš„æ˜¯department.objectå¯¹è±¡ï¼Œ.titleè·å–åˆ°çš„æ˜¯å¯¹è±¡çš„å±æ€§
      ```

  
  
  
  
## 6.5ï¼šFormå’ŒModelForm

  djangoä¸­çš„formæœ‰ä¸¤å¤§ä½œç”¨

  - ç”ŸæˆHTMLè¡¨å•æ ‡ç­¾
  - æ•°æ®æ ¡éªŒ

  å¿«é€Ÿä¸Šæ‰‹

  - å®šä¹‰ç±»
  
    - ```python
      class MyForm(forms.Form):
          a1 = 
          a2 = 
      ```
    
    - è§†å›¾å‡½æ•°
    
      - ```python
        def xxx(request):
            if request.method == 'GET':
                form = MyFrom()
                return render(request,'xxx.html',{'form':form})
            #å¯¹ç”¨æˆ·æäº¤çš„æ•°æ®è¿›è¡Œåˆæ³•æ€§æ ¡éªŒ
            from = MyForm(data=request.POST)
            if form.is_valid():
                print('æˆåŠŸ',form.cleaned_data) # ä¼šè¿”å›ä¸€ä¸ªå­—å…¸{a1:124,a2:344}
            else:
                form.errors # è·å–æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯
        ```
    
    - åœ¨HTMLæ–‡ä»¶ä¸­
    
      - ```python
        <from method='POST'>
        {{ form.a1 }}
        {{ form.a2 }}
        <input type='submit' value='æäº¤' />
        <form/>
        ```

### 6.5.1ï¼šç”Ÿæˆæ ‡ç­¾

- ```python
  #views.py æ–‡ä»¶
  from django.shortcuts import render
  from django import forms
  class RoleForm(forms.Form):
      user = forms.CharField(label="ç”¨æˆ·å",
      widget=forms.TextInput(attrs={"class": "form-control"})
      )
      password = forms.CharField(label="å¯†ç ",
      widget=forms.PasswordInput(attrs={"class": "form-control"}) 
      )
      email = forms.EmailField(label="é‚®ç®±",
      widget=forms.EmailInput(attrs={"class": "form-control"})
      )
  # Create your views here.
  def add_role(request):
      form = RoleForm()   #è¿™ç§æƒ…å†µçš„å®ä¾‹åŒ–æ²¡æœ‰é»˜è®¤å€¼
      #form = RoleForm(initial={"user": "admin","password": "123456","email": "admin@163.com"})   #è¿™ç§æƒ…å†µä¸‹ä¼šæœ‰é»˜è®¤å€¼
      return render(request, "add_role.html", {"form": form})
  ```

- ```python
  #htmlæ–‡ä»¶
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>Title</title>
    </head>
    <body>
      {{ form.user }}
      {{ form.password }}
      {{ form.email }}
      <input type="submit" value="æäº¤">
    </body>
  </html>
  ```

æœ€ç»ˆæ•ˆæœ

![image-20251006142152432](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251006142152432.png)

### 6.5.2ï¼šåˆæ­¥æ ¡éªŒ

```python
#views.py
from django.shortcuts import render
from django.http import HttpResponse
from django import forms
class RoleForm(forms.Form):
    user = forms.CharField(label="ç”¨æˆ·å",
    widget=forms.TextInput(attrs={"class": "form-control"})
    )
    password = forms.CharField(label="å¯†ç ",
    widget=forms.PasswordInput(attrs={"class": "form-control"},render_value=True) 
    )
    email = forms.EmailField(label="é‚®ç®±",
    widget=forms.EmailInput(attrs={"class": "form-control"})
    )
# Create your views here.
def add_role(request):
    if request.method == "GET":
        form = RoleForm(initial={"user": "admin","password": "123456","email": "admin@163.com"})
        return render(request, "add_role.html", {"form": form})
    else:
        # å¤„ç†POSTè¯·æ±‚,å¯¹ç”¨æˆ·æäº¤çš„æ•°æ®è¿›è¡Œæ ¡éªŒ
        form = RoleForm(request.POST)
        if form.is_valid():
            return HttpResponse("æäº¤æˆåŠŸ")
            data = form.cleaned_data   #è¿”å›çš„æ˜¯å­—å…¸ç±»å‹çš„æ•°æ®
        else:
            #form.errors æ˜¯ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯
            #formå¯¹è±¡
            return render(request, "add_role.html", {"form": form})
```

```python
#add_role.py
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Title</title>
  </head>
  <body>
    <form method="post" novalidate>
        {% csrf_token %}
        <p>{{ form.user }} <span style="color: red;">{{ form.user.errors.0 }}</span></p>
        <p>{{ form.password }} <span style="color: red;">{{ form.password.errors.0 }}</span></p>
        <p>{{ form.email }} <span style="color: red;">{{ form.email.errors.0 }}</span></p>
        <input type="submit" value="æäº¤">
    </form>
  </body>
</html>
```

é¡µé¢ä¸­å¢åŠ äº†é”™è¯¯ä¿¡æ¯

![image-20251006145303987](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251006145303987.png)

ä¸Šå›¾ä¸­settings.pyæ–‡ä»¶ä¸­å¯ä»¥ä¿®æ”¹æŠ¥é”™çš„è¯­è¨€

- è‡ªå®šä¹‰éªŒè¯è§„åˆ™   (å¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå®ç°)

  - ```pyt
    #views.py
    from django.core.validators import RegexValidator
    ......
    ......
      email = forms.EmailField(label="é‚®ç®±",
        widget=forms.EmailInput(attrs={"class": "form-control"}),
        validators=[RegexValidator(r"^[a-z0-9]+@[a-z0-9]+\.[a-z]{2,}$")]
        )
    ```

## ç»¼åˆæ¡ˆä¾‹ 

### 1ï¼šdb.sqlite3å¸¸ç”¨ç»ˆç«¯â€œå¢åˆ æ”¹æŸ¥â€æŒ‡ä»¤

- ```python
  python manage.py dbshell #è¿›å…¥è‡ªå®šä¹‰æœåŠ¡å™¨ç»ˆç«¯
  Department.objects.create(title="å¸‚åœºéƒ¨", count=30)  #ç»™Departmentè¡¨æ’å…¥æ•°æ®
  .tables #æŸ¥çœ‹æ•°æ®åº“ä¸­æœ‰å“ªäº›è¡¨
  .exit #æ¨å‡ºæ•°æ®åº“
  .schema auth_user  #æŸ¥çœ‹auth_userè¡¨æ•°æ®
  INSERT INTO è¡¨å (å­—æ®µ1, å­—æ®µ2, ...) VALUES ('å€¼1', 'å€¼2', ...); #æ’å…¥æ•°æ®
  ```

- ```py
  #.views.pyæ–‡ä»¶
  from django.shortcuts import render
  from django.http import HttpResponse
  from django import forms
  from django.core.validators import RegexValidator
  from app01 import models
  class LoginForm(forms.Form):
      user = forms.CharField(label="ç”¨æˆ·å",
      widget=forms.TextInput(attrs={"class": "form-control","placeholder": "è¯·è¾“å…¥ç”¨æˆ·å"})
      )
      password = forms.CharField(label="å¯†ç ",
      widget=forms.PasswordInput(attrs={"class": "form-control","placeholder": "è¯·è¾“å…¥å¯†ç "},render_value=True) 
      )
  class RoleForm(forms.Form):
      user = forms.CharField(label="ç”¨æˆ·å",
      widget=forms.TextInput(attrs={"class": "form-control"})
      )
      password = forms.CharField(label="å¯†ç ",
      widget=forms.PasswordInput(attrs={"class": "form-control"},render_value=True) 
      )
      email = forms.EmailField(label="é‚®ç®±",
      widget=forms.EmailInput(attrs={"class": "form-control"}),
      validators=[RegexValidator(r"^[a-z0-9]+@[a-z0-9]+\.[a-z]{2,}$","è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±")]
      )
  # Create your views here.
  def add_role(request):
      if request.method == "GET":
          form = RoleForm(initial={"user": "admin","password": "123456","email": "admin@163.com"})
          return render(request, "add_role.html", {"form": form})
      else:
          # å¤„ç†POSTè¯·æ±‚,å¯¹ç”¨æˆ·æäº¤çš„æ•°æ®è¿›è¡Œæ ¡éªŒ
          form = RoleForm(request.POST)
          if form.is_valid():
              return HttpResponse("æäº¤æˆåŠŸ")
              data = form.cleaned_data   #è¿”å›çš„æ˜¯å­—å…¸ç±»å‹çš„æ•°æ®
          else:
              #form.errors æ˜¯ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯
              #formå¯¹è±¡
              return render(request, "add_role.html", {"form": form})
  
  def login(request):  
      #ç”¨æˆ·ç™»å½•
      if request.method == "GET":
          form = LoginForm()
          return render(request, "login.html",{"form": form})
      else:
          form = LoginForm(request.POST)
          if form.is_valid():
              #å¾—åˆ°çš„æ˜¯å­—å…¸ä¿¡æ¯
              data = form.cleaned_data
              # user = models.UserInfo.objects.filter(user=data["user"],password=data["password"]).first()
              user = models.UserInfo.objects.filter(**data).first()   #**dataæ˜¯è§£åŒ…ï¼Œå°†å­—å…¸ä¸­çš„é”®å€¼å¯¹è§£åŒ…æˆå…³é”®å­—å‚æ•°
              if user:
                  return HttpResponse("ç™»å½•æˆåŠŸ")
              else:
                   return render(request, "login.html", {"form": form,"error_msg": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"})
          else:
              return render(request, "login.html", {"form": form})
      
  ```

- ```python
  #htmlæ–‡ä»¶
  <!DOCTYPE html>
  <html>
  <head> 
      <meta charset="UTF-8">
      <title>ç”¨æˆ·ç™»å½•</title>
      <style>
          body {
              font-family: Arial, sans-serif;
              background-color: #f5f5f5;
              margin: 0;
              padding: 0;
              display: flex;
              justify-content: center;
              align-items: center;
              min-height: 100vh;
          }
          .login-box {
              width: 400px;
              background: white;
              border: 1px solid #ddd;
              border-radius: 5px;
              padding: 30px;
              box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          }
          .login-box h2 {
              text-align: center;
              margin-bottom: 30px;
              color: #333;
              font-size: 24px;
          }
          .form-group {
              margin-bottom: 20px;
          }
          .form-group label {
              display: block;
              margin-bottom: 8px;
              color: #333;
              font-weight: normal;
          }
          .form-control {
              width: 100%;
              padding: 12px;
              border: 1px solid #ddd;
              border-radius: 4px;
              font-size: 14px;
              box-sizing: border-box;
          }
          .form-control:focus {
              outline: none;
              border-color: #007bff;
          }
          .btn {
              width: 100%;
              padding: 12px;
              background-color: #007bff;
              color: white;
              border: none;
              border-radius: 4px;
              font-size: 16px;
              cursor: pointer;
              margin-top: 10px;
          }
          .btn:hover {
              background-color: #0056b3;
          }
      </style>
  </head>
  <body>
      <div class="login-box">
          <h2>ç”¨æˆ·ç™»å½•</h2>
          <form method="post" novalidate>
              {% csrf_token %}
              <div class="form-group">
                  <label for="username">ç”¨æˆ·å</label>
                  <!-- <input type="text" class="form-control" id="username" name="user" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required> -->
                  {{ form.user }}
                  <span style="color: red;">{{ form.user.errors.0 }}</span>
              </div>
              <div class="form-group">
                  <label for="password">å¯†ç </label>
                  <!-- <input type="password" class="form-control" id="password" name="pwd" placeholder="è¯·è¾“å…¥å¯†ç " required> -->
                  {{ form.password }}
                  <span style="color: red;">{{ form.password.errors.0 }}</span>
              </div>
              <button type="submit" class="btn">æ äº¤</button>
              <span style="color: red;">{{ error_msg }}</span>
          </form>
      </div>
  </body>
  </html> 
  ```

- ```python
  #models.pyæ–‡ä»¶
  from django.db import models
  
  # Create your models here.
  class UserInfo(models.Model):
      user = models.CharField(verbose_name="ç”¨æˆ·å",max_length=32)
      password = models.CharField(verbose_name="å¯†ç ",max_length=32)
  ```

## 6.6ï¼šModelForm

- models.py

  - ```python
    from django.db import models
    
    # Create your models here.
    class UserInfo(models.Model):
        user = models.CharField(verbose_name="ç”¨æˆ·å",max_length=32)
        password = models.CharField(verbose_name="å¯†ç ",max_length=32)
    ```

- ModelForm

  - ```python
    class LoginModelForm(forms.ModelForm):
        class Meta:
            model = models.UserInfo
            fields = ['user','passowrd']
            #æˆ–è€…
            fields = '__all__'  #åŒä¸‹åˆ’çº¿
            widgets = {
                'user':forms.TextInput(attrs={'class':'form-control'})
            }
    ```

  - é»˜è®¤æ˜¾ç¤ºæ•°æ®+ä¿å­˜æ•°æ®

    - ```python
      obj = LoginModelForm(data=request.POST)
      obj.save()  #models.UserInfo.objects.create(......)
      ```

    - ```python
      obj = models.UserInfo.objects.filter(id=1).first()
      obj = LoginModelForm(instance=obj)
      obj.save()  #models.UserInfo.objects.create(......)
      ```

  ## ç»¼åˆæ¡ˆä¾‹

  ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚

  æ‰©å±•çŸ¥è¯†

  ![image-20251007130527288](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251007130527288.png)

![image-20251007130706032](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251007130706032.png)

# ç¬¬ä¸ƒç« ï¼šå·ç ç®¡ç†ç³»ç»Ÿ

## 7.1ï¼šè¡¨ç»“æ„

![image-20251007132242823](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251007132242823.png)

## 7.2ï¼šé¡¹ç›®&è¡¨ç»“æ„

```python
from django.db import models

class Department(models.Model):
    """éƒ¨é—¨è¡¨"""
    title = models.CharField(max_length=32, verbose_name="éƒ¨é—¨åç§°")
class Admin(models.Model):
    """ç®¡ç†å‘˜è¡¨"""
    username = models.CharField(max_length=32,verbose_name="ç”¨æˆ·å")
    password = models.CharField(max_length=32,verbose_name="å¯†ç ")
    gender = models.IntegerField(
        verbose_name="æ€§åˆ«",
        choices=[(1,"ç”·"),(0,"å¥³")]
    )
    depart = models.ForeignKey(
        verbose_name="éƒ¨é—¨",
        to="Department",
        on_delete=models.CASCADE
    )
class Phone(models.Model):
    """æ‰‹æœºå·è¡¨"""
    mobile = models.CharField(max_length=11,verbose_name="æ‰‹æœºå·")
    price = models.PositiveIntegerField(verbose_name="ä»·æ ¼",default=0)
    level = models.SmallIntegerField(
        verbose_name="ç­‰çº§",
        choices=[(1,"ä¸€çº§"),(2,"äºŒçº§"),(3,"ä¸‰çº§"),(4,"å››çº§")],
        default=1
        )
    status = models.BooleanField(verbose_name="çŠ¶æ€",default=False)
    admin = models.ForeignKey(
        verbose_name="ç®¡ç†å‘˜",
        to="Admin",
        on_delete=models.CASCADE
    )


```

## 7.3ï¼šç”¨æˆ·ç™»å½•

- åŸºæœ¬é€»è¾‘+é¡µé¢
- å¯†ç +å¯†æ–‡å­˜å‚¨
- å›¾ç‰‡éªŒè¯ç 

![image-20251007170507821](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251007170507821.png)

<span style="color:red">é¡¹ç›®åç§°ï¼šmyprojcet</span>

## 7.4ï¼šhomeç•Œé¢





## å‘åç«¯å‘é€è¯·æ±‚ï¼šAjax

- <a href="XXXX/XXX/?name=XX&age=XXX"></a>    ä¼šè¿›è¡Œç•Œé¢è·³è½¬å¹¶ä¸”åˆ·æ–°

- #<form method="POST">
      <input .../>
  </form>

- å‘é€Ajaxè¯·æ±‚ï¼šJSåº•å±‚ä½¿ç”¨XmlHttpReponseå¯¹è±¡å®ç°ã€‚

  - 1ï¼šå¼•å…¥JQuery/axios

  - 2ï¼šå‘é€Ajax

    -  /admin/delete/?aid=123    # ç›¸å½“äºå‘ /admin/delete/ å‘é€GETè¯·æ±‚ æ•°æ®ä¸º aid=123

    - ```py
      $.ajax({
          url:"/admin/delete",
          type:"GET",
          data:{
              aid:123
          },
          dataType:"json",
          success:function(res){
              console.log("è¯·æ±‚è¿”å›å€¼:",res);
          }
      })
      ```

## æ€»ç»“

![image-20251009163037327](C:\Users\86136\AppData\Roaming\Typora\typora-user-images\image-20251009163037327.png)

![image-20251009163125689](C:\Users\86136\AppData\Roaming\Typora\typora-user-images\image-20251009163125689.png)
