#   第一章：Django学习

## 1.1-1.2

![image-20251001150115345](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251001150115345.png)

## 1.3： 快速启动

网站启动起来，通过浏览器就可以访问了。

首先创建项目：<code>django-admin startproject  名字</code>

- 打开终端并且进入项目根目录（看到manage.py)
- 执行命令，启动网站：<code>python manage.py runserver</code>
- ![image-20251001151050963](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251001151050963.png)

## 1.4 ：APP

在Django中创建APP，在APP中编写项目中的具体业务。

执行<code>python manage.py startapp web</code>命令后，会在当前项目目录下创建文件夹，并且在文件夹中会创建相关的文件。

代码目录结构如下：

E:.
│  db.sqlite3
│  manage.py
│  
├─mysite
│  │  asgi.py
│  │  settings.py
│  │  urls.py
│  │  wsgi.py
│  │  __init__.py
│  │  
│  └─__pycache__
│          settings.cpython-39.pyc
│          urls.cpython-39.pyc
│          wsgi.cpython-39.pyc
│          __init__.cpython-39.pyc
│
└─web
    │  admin.py   [内部后台管理配置，不要动]
    │  apps.py    [App名字，不用动，不用修改]
    │  models.py   [数据库，类->SQL语句(ORM)] 	（经常使用）
    │  tests.py     [单元测试，不用动]
    │  views.py     [视图函数，例如login函数]     （经常使用）
    │  __init__.py
    │
    └─migrations   [迁移记录，自动生成，不需要修改]
            __init__.py

## 小结

+ 安装Django框架 <code> pip install django=3</code>
+ 创建项目-命令 <code>django-admin startproject 名字</code>
+ 创建APP <code>python manage.py startapp 名字</code>
+ 编写业务代码：urls.py、views.py
+ 启动项目 <code>python manage.py runserver</code>

# 第二章：初识视图函数

## 2.1 基本模块内容介绍

```py
from django.shortcuts import render
from django.shortcuts import HttpResponse
def login(request):
    return HttpResponse("Hello, World!")
```

- request是用户请求的所有内容，去request中获取用户提交的所有信息。

- 函数中间进行业务逻辑操作

- 返回值，返回什么体现用户浏览器的行为不同

  - ```py
    return HttpResponse("Hello, World!")
    ```

  - ```p
    return render(request,'login.html')   返回html页面
    ```

  - ```pytho
    return redirect("https://www.baidu.com") 跳转页面
    ```

## 2.2 文件路径寻找

![image-20251001163430402](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251001163430402.png)

## 小结

- 参数，去request中获取值

- setting.py问价

  ```py
  INSTALLED_APPS = [
      "django.contrib.admin",
      "django.contrib.auth",
      "django.contrib.contenttypes",
      "django.contrib.sessions",
      "django.contrib.messages",
      "django.contrib.staticfiles",
  ]
  ............///////
  TEMPLATES = [
      {
          "BACKEND": "django.template.backends.django.DjangoTemplates",
          "DIRS": [],
          "APP_DIRS": True,
          "OPTIONS": {
              "context_processors": [
                  "django.template.context_processors.debug",
                  "django.template.context_processors.request",
                  "django.contrib.auth.context_processors.auth",
                  "django.contrib.messages.context_processors.messages",
              ],
          },
      },
  ]
  ```

  会优先在项目设置的 “DIRS”中的目录去查找，然后再去“INSTALLED_APPS”中查找

  - 单独APP模板，在APP中写。公共的就在最外层的templates中写HTML模板。

# 第三章：初识模板

web框架中都要用到模板的语法，用户看到的是动态的。

<strong>案例：号码列表</strong>

- URL访问 -》 去数据库获取数据列表 -》 页面上展示 

# 第四章：静态文件处理

图片、css、js等。

![image-20251002140900441](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251002140900441.png)

相关的静态文件都放到这个static文件夹下面，引用代码如下：

```py
{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理系统首页</title>
    <link rel="stylesheet" href="{% static 'bootstrap-3.0.0/dist/css/bootstrap.min.css' %}">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        
        .navbar-brand {
            font-weight: bold;
            font-size: 20px;
        }
        
        .main-content {
            margin-top: 30px;
            margin-bottom: 50px;
        }
        
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin: 0 -15px 30px -15px;
            border-radius: 0;
        }
        
        .page-header h1 {
            margin: 0;
            text-align: center;
            font-size: 32px;
            font-weight: 300;
        }
        
        .stats-cards {
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .table-container {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .table-title {
            margin-bottom: 20px;
            color: #333;
            font-size: 20px;
            font-weight: 500;
        }
        
        .table {
            margin-bottom: 0;
        }
        
        .table thead th {
            background-color: #f8f9fa;
            border-top: none;
            font-weight: 600;
            color: #495057;
            padding: 15px;
        }
        
        .table tbody td {
            padding: 12px 15px;
            vertical-align: middle;
        }
        
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .btn-toolbar {
            margin-bottom: 20px;
        }
        
        .search-box {
            max-width: 300px;
        }
        
        .navbar-nav > li > a {
            padding-top: 20px;
            padding-bottom: 20px;
        }
        
        .navbar {
            min-height: 60px;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="sr-only">切换导航</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/index/">📱 通讯录管理系统</a>
            </div>

            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="/index/">首页</a></li>
                    <li><a href="/user_list/">用户列表</a></li>
                    <li><a href="/phone_list/">电话列表</a></li>
                </ul>
                
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            👤 用户中心 <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="#">个人资料</a></li>
                            <li><a href="#">设置</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="/login/">退出登录</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <div class="container main-content" style="margin-top: 80px;">
        <!-- 页面标题 -->
        <div class="page-header">
            <h1>📊 系统概览</h1>
        </div>

        <!-- 统计卡片 -->
        <div class="row stats-cards">
            <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                    <div class="stat-number">{{ queryset|length }}</div>
                    <div class="stat-label">总联系人数</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                    <div class="stat-number">4</div>
                    <div class="stat-label">城市分布</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                    <div class="stat-number">100%</div>
                    <div class="stat-label">数据完整性</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                    <div class="stat-number">在线</div>
                    <div class="stat-label">系统状态</div>
                </div>
            </div>
        </div>

        <!-- 数据表格 -->
        <div class="table-container">
            <div class="table-title">
                📞 联系人列表
            </div>
            
            <div class="btn-toolbar">
                <div class="btn-group">
                    <button type="button" class="btn btn-primary">
                        <span class="glyphicon glyphicon-plus"></span> 添加联系人
                    </button>
                    <button type="button" class="btn btn-default">
                        <span class="glyphicon glyphicon-export"></span> 导出数据
                    </button>
                </div>
                <div class="pull-right">
                    <div class="input-group search-box">
                        <input type="text" class="form-control" placeholder="搜索联系人...">
                        <span class="input-group-btn">
                            <button class="btn btn-default" type="button">
                                <span class="glyphicon glyphicon-search"></span>
                            </button>
                        </span>
                    </div>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th width="10%">ID</th>
                            <th width="30%">📱 电话号码</th>
                            <th width="25%">🏙️ 归属地</th>
                            <th width="35%">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in queryset %}
                        <tr>
                            <td><span class="badge">{{ row.id }}</span></td>
                            <td><strong>{{ row.phone }}</strong></td>
                            <td>
                                <span class="label label-info">{{ row.city }}</span>
                            </td>
                            <td>
                                <button class="btn btn-xs btn-info">
                                    <span class="glyphicon glyphicon-eye-open"></span> 查看
                                </button>
                                <button class="btn btn-xs btn-warning">
                                    <span class="glyphicon glyphicon-edit"></span> 编辑
                                </button>
                                <button class="btn btn-xs btn-danger">
                                    <span class="glyphicon glyphicon-trash"></span> 删除
                                </button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">
                                <em>暂无数据</em>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- 分页 -->
            <nav class="text-center">
                <ul class="pagination">
                    <li class="disabled"><a href="#">&laquo;</a></li>
                    <li class="active"><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">&raquo;</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- 底部 -->
    <footer class="text-center" style="padding: 20px; background-color: #f8f9fa; margin-top: 50px;">
        <p class="text-muted">&copy; 2024 通讯录管理系统. All rights reserved.</p>
    </footer>

    <script src="{% static 'jQuery/jquery-3.6.0.min.js' %}"></script>
    <script src="{% static 'bootstrap-3.0.0/dist/js/bootstrap.min.js' %}"></script>
</body>
</html> 
```

# 第五章：ORM

ORM：对象关系映射。

![image-20251002142828031](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251002142828031.png)

出现的目的：便于对项目中的数据库进行开发。

- 创建表结构&修改表结构
- 对表中的数据进行修改

## 5.1:自己创建数据库

- 第一步创建以自己的数据库用户

![image-20251002155706583](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251002155706583.png)

- ```py
  CREATE DATABASE IF NOT EXISTS mydb CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
  ```



## 5.2：创建表

去APP下的model.py中创建指定的类+命令，自动创建表。

线连接数据库：day08

在setting.py文件中

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'day08',
        'USER': 'root',
        'PASSWORD': '',
        'HOST': 'localhost',
        'PORT': 3306,
    }
}
```

- python 代码连接数据库：pymysql、mysqlclient

```python
pip install mysqlclient
```

再去执行 5.2.2：命令

### 5.2.1：编写类

```python
from django.db import models
class UserInfo(models.Model):
    name = models.CharField(verbose_name='性别',max_length=12)
    age = models.IntegerField(verbose_name='年龄')  
    email = models.EmailField(verbose_name='邮箱',max_length=32)
# Create your models here.
```

### 5.2.2：命令

```py
python manage.py makemigrations
python manage.py migrate	
```

- makemigrations：读取已经注册的所有APP中的models.py文件，根据类生成配置文件，并放到APP下的migrations目录。
- migrate,根据配置文件自动生成相应的SQL语句。

### 5.2.3：小结

- 自己创建数据库

- django中配置连接数据库

- python操作mysql模块

  - ```python
    python install mysqlclient	
    ```

- model.py中写相应的类

- 写完后去执行相应的命令

  - ```python
    python manage.py makemigrations
    python manage.py migrate
    ```

## 5.3  数据操作

```python
#model.py
from django.db import models
class UserInfo(models.Model):
    name = models.CharField(verbose_name='性别',max_length=12)
    age = models.IntegerField(verbose_name='年龄')  
    email = models.EmailField(verbose_name='邮箱',max_length=32)
# Create your models here.
```

- 新增

  - ```python
    models.UserInfo.objects.create(name = "Cheng",pwd = "123",age = 19,email = "xxx@qq.com")
    #或者
    models.UserInfo.objects.create(**{"name":"Cheng","pwd":"123","age":"18","email":"xxx@qq.com"})
    ```

- 查询

  - ```python
    #queryset = [obj,obj,obj]    obj.id,obj.name,obj.age,obj.pwd
    v1 = models.UserInfo.objects.filters(name = 'wupeiqi',age = 18)
    #queryset = [obj,obj,obj]    obj.id,obj.name,obj.age,obj.pwd
    v2 = models.UserInfo.objects.all()
    V3 = models.UserInfo.objects.filter(name = 'wupeiqi',age = 19).first()
    #注意：未查询到数据时返回None
    ```

- 删除

  ```python
  models.UserInfo.objects.all().delete()
  models.UserInfo.objects.filter(name='wupeiqi',age = 10).delete()
  ```

- 修改

  ```python
  models.UserInfo.objects.all().update(age=19)
  models.UserInfo.objects.filter(id=10).update(age=19)
  ```

## 案例

- 创建数据库

- 创建数据库表

  - ```pytho
    #model.py
    from django.db import models
    class UserInfo(models.Model):
        name = models.CharField(verbose_name='性别',max_length=12)
        age = models.IntegerField(verbose_name='年龄')  
        email = models.EmailField(verbose_name='邮箱',max_length=32)
    # Create your models here.
    ```

## 总结

- Django框架

  - ```python
    pip install django=3
    ```

- 创建项目

- 配置

  - 注册APP
  - MySql连接（数据库先创建）

- 再APP目标下的models.py中创建表结构

  - 写models
  - 命令

- 写功能代码

  - urls.py
  - views.py(基于ORM对数据库中的表数据进行操作)
  - templates（主要放置HTML文件）

- 静态文件配置（CSS，JS，图片）

# 第六章：Django进阶

## 6.1：Cookie和Session

项目登陆相关

![image-20251003154228169](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251003154228169.png)

<strong>用户登录流程</strong>

![image-20251003165415663](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251003165415663.png)



## 6.2：中间件

!![image-20251003192928888](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251003192928888.png)(C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251003185509278.png) 

```python
#Setting.py
MIDDLEWARE = [
    "django.middleware.security.SecurityMiddleware",
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "django.middleware.clickjacking.XFrameOptionsMiddleware",
    "myproject01.exit.md.MyMiddleware",    #该行为自己添加的中间件
]
```

以上代码中便是一个个中间件

自己写的中间件也要再“MIDDLEWARE”中进行注册。

特点：所有的请求都会经过中间件。

```pytho
# md.py
from django.utils.deprecation import MiddlewareMixin
from django.shortcuts import redirect

class MyMiddleware(MiddlewareMixin):
    def process_request(self, request):
        # 定义不需要登录验证的URL白名单
        white_list = ['/login/', '/admin/']
        
        # 如果当前请求的URL在白名单中，直接放行
        if request.path_info in white_list: 
            return None
            
        # 检查用户是否已登录
        info_dict = request.session.get("info")
        if info_dict:
            # 已登录用户，继续处理请求
            request.info = info_dict
            return None
        else:
            # 未登录用户，重定向到登录页面
            return redirect("/login/")
    
    def process_response(self, request, response):
        return response
```

以上为中间件的内容

- 有时候static中的静态文件没有办法正确显示，有可能是因为中间件把静态文件阻止了。可以在md.py文件中进行设置白名单。

## 6.3：母版的概念

- 母版文件

  - ```python
    #layout.html
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <title>layout</title>
        {% block css %}
        {% endblock %}
      </head>
      <body>
        <div style="width: 100%;height: 100px;background-color: #000;">导航栏</div>
        <div class="container">
          {% block content %}
          {% endblock %}
        </div>
        {% block js %}
        {% endblock %}
      </body>
    </html>
    ```

- 继承母版的文件

  - ```python
    #home.html
    {% extends "layout.html" %}
    {% block css %}
    
    {% endblock %}
    {% block content %}
    <h2>欢迎{{ request.session.info }}</h2>
    {% endblock %}
    {% block js %}
    
    {% endblock %}
    ```

## 6.4：连表操作

![image-20251003202601087](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251003202601087.png)

  其中depart字段会在数据库中变为depart_id。

- 新增

  - ```python
    models.User.objects.create(name="wupeiqi",age=11,salary=10000,depart_id=1)
    #方式二
    depart_object = models.Department.object.filter(id=1).first()
    models.User.object.create(name="Cheng",age=11,salary=100000,depart=depart_object)
    ```

- 查询

  - ```python
    models.User.objects.filter(name='XX')
    models.User.objects.filter(salary='')
    models.User.objects.filter(depart_id=1)
    models.User.objects.filter(depart__title="销售")   #双下划线，可以连表访问到department表
    ```

  - 获取数据

    - ```python
      queryset = models.User.objects.all()
      for row in queryset:
          row.id,row.name   row.depart.title      #其中row.depart 获取到的是department.object对象，.title获取到的是对象的属性
      ```

  
  
  
  
## 6.5：Form和ModelForm

  django中的form有两大作用

  - 生成HTML表单标签
  - 数据校验

  快速上手

  - 定义类
  
    - ```python
      class MyForm(forms.Form):
          a1 = 
          a2 = 
      ```
    
    - 视图函数
    
      - ```python
        def xxx(request):
            if request.method == 'GET':
                form = MyFrom()
                return render(request,'xxx.html',{'form':form})
            #对用户提交的数据进行合法性校验
            from = MyForm(data=request.POST)
            if form.is_valid():
                print('成功',form.cleaned_data) # 会返回一个字典{a1:124,a2:344}
            else:
                form.errors # 获取所有的错误信息
        ```
    
    - 在HTML文件中
    
      - ```python
        <from method='POST'>
        {{ form.a1 }}
        {{ form.a2 }}
        <input type='submit' value='提交' />
        <form/>
        ```

### 6.5.1：生成标签

- ```python
  #views.py 文件
  from django.shortcuts import render
  from django import forms
  class RoleForm(forms.Form):
      user = forms.CharField(label="用户名",
      widget=forms.TextInput(attrs={"class": "form-control"})
      )
      password = forms.CharField(label="密码",
      widget=forms.PasswordInput(attrs={"class": "form-control"}) 
      )
      email = forms.EmailField(label="邮箱",
      widget=forms.EmailInput(attrs={"class": "form-control"})
      )
  # Create your views here.
  def add_role(request):
      form = RoleForm()   #这种情况的实例化没有默认值
      #form = RoleForm(initial={"user": "admin","password": "123456","email": "admin@163.com"})   #这种情况下会有默认值
      return render(request, "add_role.html", {"form": form})
  ```

- ```python
  #html文件
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>Title</title>
    </head>
    <body>
      {{ form.user }}
      {{ form.password }}
      {{ form.email }}
      <input type="submit" value="提交">
    </body>
  </html>
  ```

最终效果

![image-20251006142152432](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251006142152432.png)

### 6.5.2：初步校验

```python
#views.py
from django.shortcuts import render
from django.http import HttpResponse
from django import forms
class RoleForm(forms.Form):
    user = forms.CharField(label="用户名",
    widget=forms.TextInput(attrs={"class": "form-control"})
    )
    password = forms.CharField(label="密码",
    widget=forms.PasswordInput(attrs={"class": "form-control"},render_value=True) 
    )
    email = forms.EmailField(label="邮箱",
    widget=forms.EmailInput(attrs={"class": "form-control"})
    )
# Create your views here.
def add_role(request):
    if request.method == "GET":
        form = RoleForm(initial={"user": "admin","password": "123456","email": "admin@163.com"})
        return render(request, "add_role.html", {"form": form})
    else:
        # 处理POST请求,对用户提交的数据进行校验
        form = RoleForm(request.POST)
        if form.is_valid():
            return HttpResponse("提交成功")
            data = form.cleaned_data   #返回的是字典类型的数据
        else:
            #form.errors 是个对象，包含了所有的错误信息
            #form对象
            return render(request, "add_role.html", {"form": form})
```

```python
#add_role.py
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Title</title>
  </head>
  <body>
    <form method="post" novalidate>
        {% csrf_token %}
        <p>{{ form.user }} <span style="color: red;">{{ form.user.errors.0 }}</span></p>
        <p>{{ form.password }} <span style="color: red;">{{ form.password.errors.0 }}</span></p>
        <p>{{ form.email }} <span style="color: red;">{{ form.email.errors.0 }}</span></p>
        <input type="submit" value="提交">
    </form>
  </body>
</html>
```

页面中增加了错误信息

![image-20251006145303987](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251006145303987.png)

上图中settings.py文件中可以修改报错的语言

- 自定义验证规则   (可以通过正则表达式进行实现)

  - ```pyt
    #views.py
    from django.core.validators import RegexValidator
    ......
    ......
      email = forms.EmailField(label="邮箱",
        widget=forms.EmailInput(attrs={"class": "form-control"}),
        validators=[RegexValidator(r"^[a-z0-9]+@[a-z0-9]+\.[a-z]{2,}$")]
        )
    ```

## 综合案例 

### 1：db.sqlite3常用终端“增删改查”指令

- ```python
  python manage.py dbshell #进入自定义服务器终端
  Department.objects.create(title="市场部", count=30)  #给Department表插入数据
  .tables #查看数据库中有哪些表
  .exit #推出数据库
  .schema auth_user  #查看auth_user表数据
  INSERT INTO 表名 (字段1, 字段2, ...) VALUES ('值1', '值2', ...); #插入数据
  ```

- ```py
  #.views.py文件
  from django.shortcuts import render
  from django.http import HttpResponse
  from django import forms
  from django.core.validators import RegexValidator
  from app01 import models
  class LoginForm(forms.Form):
      user = forms.CharField(label="用户名",
      widget=forms.TextInput(attrs={"class": "form-control","placeholder": "请输入用户名"})
      )
      password = forms.CharField(label="密码",
      widget=forms.PasswordInput(attrs={"class": "form-control","placeholder": "请输入密码"},render_value=True) 
      )
  class RoleForm(forms.Form):
      user = forms.CharField(label="用户名",
      widget=forms.TextInput(attrs={"class": "form-control"})
      )
      password = forms.CharField(label="密码",
      widget=forms.PasswordInput(attrs={"class": "form-control"},render_value=True) 
      )
      email = forms.EmailField(label="邮箱",
      widget=forms.EmailInput(attrs={"class": "form-control"}),
      validators=[RegexValidator(r"^[a-z0-9]+@[a-z0-9]+\.[a-z]{2,}$","请输入正确的邮箱")]
      )
  # Create your views here.
  def add_role(request):
      if request.method == "GET":
          form = RoleForm(initial={"user": "admin","password": "123456","email": "admin@163.com"})
          return render(request, "add_role.html", {"form": form})
      else:
          # 处理POST请求,对用户提交的数据进行校验
          form = RoleForm(request.POST)
          if form.is_valid():
              return HttpResponse("提交成功")
              data = form.cleaned_data   #返回的是字典类型的数据
          else:
              #form.errors 是个对象，包含了所有的错误信息
              #form对象
              return render(request, "add_role.html", {"form": form})
  
  def login(request):  
      #用户登录
      if request.method == "GET":
          form = LoginForm()
          return render(request, "login.html",{"form": form})
      else:
          form = LoginForm(request.POST)
          if form.is_valid():
              #得到的是字典信息
              data = form.cleaned_data
              # user = models.UserInfo.objects.filter(user=data["user"],password=data["password"]).first()
              user = models.UserInfo.objects.filter(**data).first()   #**data是解包，将字典中的键值对解包成关键字参数
              if user:
                  return HttpResponse("登录成功")
              else:
                   return render(request, "login.html", {"form": form,"error_msg": "用户名或密码错误"})
          else:
              return render(request, "login.html", {"form": form})
      
  ```

- ```python
  #html文件
  <!DOCTYPE html>
  <html>
  <head> 
      <meta charset="UTF-8">
      <title>用户登录</title>
      <style>
          body {
              font-family: Arial, sans-serif;
              background-color: #f5f5f5;
              margin: 0;
              padding: 0;
              display: flex;
              justify-content: center;
              align-items: center;
              min-height: 100vh;
          }
          .login-box {
              width: 400px;
              background: white;
              border: 1px solid #ddd;
              border-radius: 5px;
              padding: 30px;
              box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          }
          .login-box h2 {
              text-align: center;
              margin-bottom: 30px;
              color: #333;
              font-size: 24px;
          }
          .form-group {
              margin-bottom: 20px;
          }
          .form-group label {
              display: block;
              margin-bottom: 8px;
              color: #333;
              font-weight: normal;
          }
          .form-control {
              width: 100%;
              padding: 12px;
              border: 1px solid #ddd;
              border-radius: 4px;
              font-size: 14px;
              box-sizing: border-box;
          }
          .form-control:focus {
              outline: none;
              border-color: #007bff;
          }
          .btn {
              width: 100%;
              padding: 12px;
              background-color: #007bff;
              color: white;
              border: none;
              border-radius: 4px;
              font-size: 16px;
              cursor: pointer;
              margin-top: 10px;
          }
          .btn:hover {
              background-color: #0056b3;
          }
      </style>
  </head>
  <body>
      <div class="login-box">
          <h2>用户登录</h2>
          <form method="post" novalidate>
              {% csrf_token %}
              <div class="form-group">
                  <label for="username">用户名</label>
                  <!-- <input type="text" class="form-control" id="username" name="user" placeholder="请输入用户名" required> -->
                  {{ form.user }}
                  <span style="color: red;">{{ form.user.errors.0 }}</span>
              </div>
              <div class="form-group">
                  <label for="password">密码</label>
                  <!-- <input type="password" class="form-control" id="password" name="pwd" placeholder="请输入密码" required> -->
                  {{ form.password }}
                  <span style="color: red;">{{ form.password.errors.0 }}</span>
              </div>
              <button type="submit" class="btn">提 交</button>
              <span style="color: red;">{{ error_msg }}</span>
          </form>
      </div>
  </body>
  </html> 
  ```

- ```python
  #models.py文件
  from django.db import models
  
  # Create your models here.
  class UserInfo(models.Model):
      user = models.CharField(verbose_name="用户名",max_length=32)
      password = models.CharField(verbose_name="密码",max_length=32)
  ```

## 6.6：ModelForm

- models.py

  - ```python
    from django.db import models
    
    # Create your models here.
    class UserInfo(models.Model):
        user = models.CharField(verbose_name="用户名",max_length=32)
        password = models.CharField(verbose_name="密码",max_length=32)
    ```

- ModelForm

  - ```python
    class LoginModelForm(forms.ModelForm):
        class Meta:
            model = models.UserInfo
            fields = ['user','passowrd']
            #或者
            fields = '__all__'  #双下划线
            widgets = {
                'user':forms.TextInput(attrs={'class':'form-control'})
            }
    ```

  - 默认显示数据+保存数据

    - ```python
      obj = LoginModelForm(data=request.POST)
      obj.save()  #models.UserInfo.objects.create(......)
      ```

    - ```python
      obj = models.UserInfo.objects.filter(id=1).first()
      obj = LoginModelForm(instance=obj)
      obj.save()  #models.UserInfo.objects.create(......)
      ```

  ## 综合案例

  。。。。。。

  扩展知识

  ![image-20251007130527288](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251007130527288.png)

![image-20251007130706032](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251007130706032.png)

# 第七章：号码管理系统

## 7.1：表结构

![image-20251007132242823](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251007132242823.png)

## 7.2：项目&表结构

```python
from django.db import models

class Department(models.Model):
    """部门表"""
    title = models.CharField(max_length=32, verbose_name="部门名称")
class Admin(models.Model):
    """管理员表"""
    username = models.CharField(max_length=32,verbose_name="用户名")
    password = models.CharField(max_length=32,verbose_name="密码")
    gender = models.IntegerField(
        verbose_name="性别",
        choices=[(1,"男"),(0,"女")]
    )
    depart = models.ForeignKey(
        verbose_name="部门",
        to="Department",
        on_delete=models.CASCADE
    )
class Phone(models.Model):
    """手机号表"""
    mobile = models.CharField(max_length=11,verbose_name="手机号")
    price = models.PositiveIntegerField(verbose_name="价格",default=0)
    level = models.SmallIntegerField(
        verbose_name="等级",
        choices=[(1,"一级"),(2,"二级"),(3,"三级"),(4,"四级")],
        default=1
        )
    status = models.BooleanField(verbose_name="状态",default=False)
    admin = models.ForeignKey(
        verbose_name="管理员",
        to="Admin",
        on_delete=models.CASCADE
    )


```

## 7.3：用户登录

- 基本逻辑+页面
- 密码+密文存储
- 图片验证码

![image-20251007170507821](C:\Users\328\AppData\Roaming\Typora\typora-user-images\image-20251007170507821.png)

<span style="color:red">项目名称：myprojcet</span>

## 7.4：home界面





## 向后端发送请求：Ajax

- <a href="XXXX/XXX/?name=XX&age=XXX"></a>    会进行界面跳转并且刷新

- #<form method="POST">
      <input .../>
  </form>

- 发送Ajax请求：JS底层使用XmlHttpReponse对象实现。

  - 1：引入JQuery/axios

  - 2：发送Ajax

    -  /admin/delete/?aid=123    # 相当于向 /admin/delete/ 发送GET请求 数据为 aid=123

    - ```py
      $.ajax({
          url:"/admin/delete",
          type:"GET",
          data:{
              aid:123
          },
          dataType:"json",
          success:function(res){
              console.log("请求返回值:",res);
          }
      })
      ```

## 总结

![image-20251009163037327](C:\Users\86136\AppData\Roaming\Typora\typora-user-images\image-20251009163037327.png)

![image-20251009163125689](C:\Users\86136\AppData\Roaming\Typora\typora-user-images\image-20251009163125689.png)
